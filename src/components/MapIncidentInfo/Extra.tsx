import * as React from 'react';
import styled from 'styled-components';
import { Incident } from '@rdrnt/tps-calls-shared';
// @ts-ignore
import { CopyToClipboard } from 'react-copy-to-clipboard';

import { Colors } from '../../config';
import { URL, Analytics } from '../../helpers';

import { IconButton } from '../Button';

import { IconNames } from '../Icon';
import { useDispatch } from 'react-redux';
import { showToast } from '../../store/ui/actions';

const ExtraContent = styled.div`
  display: flex;
  justify-content: center;
  align-items: center;
  border-top: 1px solid ${Colors.BORDER};
  height: 55px;

  > h6 {
    text-transform: uppercase;
    margin-right: 8px;
  }
`;

interface MapInfoExtraContent {
  incident: Incident<any>;
  close: () => void;
}

const ActionContent = styled.div`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;

  > *:not(:last-child) {
    margin-right: 10px;
  }
`;

const ShareButton: React.FunctionComponent<{
  iconName: IconNames;
  onClick?: () => void;
}> = ({ iconName, onClick }) => (
  <IconButton
    size={32}
    backgroundColor={Colors.PRIMARY}
    borderRadius={16}
    iconProps={{ size: 15, name: iconName, color: 'white' }}
    onClick={onClick}
  />
);

const MapInfoExtraContent: React.FunctionComponent<MapInfoExtraContent> = ({
  incident,
}) => {
  const dispatch = useDispatch();
  return (
    <ExtraContent>
      <ActionContent>
        {/* Copy link */}
        <CopyToClipboard text={URL.createShareUrl(incident.id)}>
          <ShareButton
            iconName="link"
            onClick={() => {
              dispatch(
                showToast({
                  message: 'Copied to clipboard',
                  options: {
                    intent: 'success',
                    icon: 'link',
                  },
                })
              );
              Analytics.event({
                category: 'UI',
                action: Analytics.UI.SHARE_INCIDENT_URL,
              });
            }}
          />
        </CopyToClipboard>
        {/* Twitter button */}
        <a
          className="twitter-share-button"
          href={URL.createTwitterShareUrl(incident)}
          target="_blank"
          rel="noopener noreferrer"
        >
          <ShareButton
            iconName="twitter"
            onClick={() => {
              Analytics.event({
                category: 'UI',
                action: Analytics.UI.SHARE_INCIDENT_TWITTER,
              });
            }}
          />
        </a>
      </ActionContent>
    </ExtraContent>
  );
};

export default MapInfoExtraContent;
